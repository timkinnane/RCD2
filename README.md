# rcd2

rcd2 is a chat bot built on the [Hubot][hubot] framework. It was
initially generated by [generator-hubot][generator-hubot], and configured to be
deployed on [Heroku][heroku] to get you up and running as quick as possible.

[heroku]: http://www.heroku.com
[hubot]: http://hubot.github.com
[generator-hubot]: https://github.com/github/generator-hubot

### Prerequisites

This Hubot setup has been modified from the default to have a bit more utility.
It requires some global dependencies to take full advantage of the provided npm
scripts. These can be installed as follows:

    npm install -g nodemon node-inspector opener

### Running rcd2 Locally

You can start rcd2 locally by running:

    % bin/hubot -a rocketchat

This will connect to the configured Rocket.Chat instance using
[environment variables](#configuration) (they must be set first).

While developing locally, you can use npm scripts to run versions that watch
your files and reload the bot when changes are detected.

Start RCD2 with file watching to reload on changes:

    npm run watch

Start RCD2 with file watching and code inspector:

    npm run debug

There's a final script for a specific error, if you end up with running Hubots
in parallel processes that you can't quit, to kill them all:

    npm run kill

### Configuration

Rocket.Chat must have a user added for the bot to connect to. For this Hubot,
I've called the user D2. So it will respond to the user alias `@D2` or `rcd2`.

The conenction to Rocket.Chat (and some added script behaviours) require
environment variables to be set as a simple form of configuration.

NB. This Hubot uses the Mongo DB from Rocket.Chat instead of the default Redis.
These are the suggested default configs:

    export HUBOT_LOG_LEVEL=debug
    export ROCKETCHAT_URL=http://localhost:3000
    export ROCKETCHAT_USER=D2
    export ROCKETCHAT_PASSWORD=password
    export ROCKETCHAT_AUTH=password
    export ROCKETCHAT_ROOM=general
    export LISTEN_ON_ALL_PUBLIC=false
    export RESPOND_TO_DM=false
    export RESPOND_TO_EDITED=true
    export PORT=3003
    export MONGODB_URL=mongodb://127.0.0.1:3001/hubot-brain

Each script should have a commented header which contains a "Configuration"
section that explains which values it requires to be placed in which variable.

How to set environment variables will be specific to your operating system.
Rather than recreate the various methods and best practices in achieving this,
it's suggested that you search for a dedicated guide focused on your OS.

### Scripting

An example script implimenting the methods of the Rocket.Chat Bot Helpers
package is included at `scripts/botHelpers.coffee`, so check it out to get
started, along with the [Scripting Guide][scripting-docs].

For many common tasks, there's a good chance someone has already one to do just
the thing.

[scripting-docs]: https://github.com/github/hubot/blob/master/docs/scripting.md

### external-scripts

There will inevitably be functionality that everyone will want. Instead of
writing it yourself, you can use existing plugins.

Hubot is able to load plugins from third-party `npm` packages. This is the
recommended way to add functionality to your hubot. You can get a list of
available hubot plugins on [npmjs.com][npmjs] or by using `npm search`:

    % npm search hubot-scripts panda
    NAME             DESCRIPTION                        AUTHOR DATE       VERSION KEYWORDS
    hubot-pandapanda a hubot script for panda responses =missu 2014-11-30 0.9.2   hubot hubot-scripts panda
    ...


To use a package, check the package's documentation, but in general it is:

1. Use `npm install --save` to add the package to `package.json` and install it
2. Add the package name to `external-scripts.json` as a double quoted string

You can review `external-scripts.json` to see what is included by default.

##### Advanced Usage

It is also possible to define `external-scripts.json` as an object to
explicitly specify which scripts from a package should be included. The example
below, for example, will only activate two of the six available scripts inside
the `hubot-fun` plugin, but all four of those in `hubot-auto-deploy`.

```json
{
  "hubot-fun": [
    "crazy",
    "thanks"
  ],
  "hubot-auto-deploy": "*"
}
```

**Be aware that not all plugins support this usage and will typically fallback
to including all scripts.**

[npmjs]: https://www.npmjs.com

## Deployment

    % heroku create --stack cedar
    % git push heroku master

If your Heroku account has been verified you can run the following to enable
and add the Redis to Go addon to your app.

    % heroku addons:add redistogo:nano

If you run into any problems, checkout Heroku's [docs][heroku-node-docs].

You'll need to edit the `Procfile` to set the name of your hubot.

More detailed documentation can be found on the [deploying hubot onto
Heroku][deploy-heroku] wiki page.

### Deploying to UNIX or Windows

If you would like to deploy to either a UNIX operating system or Windows.
Please check out the [deploying hubot onto UNIX][deploy-unix] and [deploying
hubot onto Windows][deploy-windows] wiki pages.

[heroku-node-docs]: http://devcenter.heroku.com/articles/node-js
[deploy-heroku]: https://github.com/github/hubot/blob/master/docs/deploying/heroku.md
[deploy-unix]: https://github.com/github/hubot/blob/master/docs/deploying/unix.md
[deploy-windows]: https://github.com/github/hubot/blob/master/docs/deploying/windows.md

## Campfire Variables

If you are using the Campfire adapter you will need to set some environment
variables. If not, refer to your adapter documentation for how to configure it,
links to the adapters can be found on [Hubot Adapters][hubot-adapters].

Create a separate Campfire user for your bot and get their token from the web
UI.

    % heroku config:add HUBOT_CAMPFIRE_TOKEN="..."

Get the numeric IDs of the rooms you want the bot to join, comma delimited. If
you want the bot to connect to `https://mysubdomain.campfirenow.com/room/42`
and `https://mysubdomain.campfirenow.com/room/1024` then you'd add it like
this:

    % heroku config:add HUBOT_CAMPFIRE_ROOMS="42,1024"

Add the subdomain hubot should connect to. If you web URL looks like
`http://mysubdomain.campfirenow.com` then you'd add it like this:

    % heroku config:add HUBOT_CAMPFIRE_ACCOUNT="mysubdomain"

[hubot-adapters]: https://github.com/github/hubot/blob/master/docs/adapters.md

## Restart the bot

You may want to get comfortable with `heroku logs` and `heroku restart` if
you're having issues.
